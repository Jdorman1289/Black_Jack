<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyScript Blackjack</title>
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #0a4d0a;
            color: #ffffff;
        }
        .card {
            width: 100px;
            height: 150px;
            display: inline-block;
            margin: 5px;
        }
        #player-cards, #dealer-cards {
            min-height: 160px;
            background-color: #0d620d;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        #game-area {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        button {
            background-color: #4a0e4a;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
        }
        button:disabled {
            background-color: #2c062c;
            cursor: not-allowed;
        }
        h1 {
            color: #ffd700;
        }
        #score {
            font-size: 1.2em;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div id="game-area">
        <h1>PyScript Blackjack</h1>
        <div id="dealer-cards"></div>
        <div id="player-cards"></div>
        <div id="score"></div>
        <button id="deal-button" py-click="deal_cards()">Deal</button>
        <button id="hit-button" py-click="hit()" disabled>Hit</button>
        <button id="stay-button" py-click="stay()" disabled>Stay</button>
    </div>

    <py-script>
import random
from pyodide.ffi import create_proxy
from js import document

deck = {
    "1♠": ["Playing-Cards/card-spades-1.png", 11], "2♠": ["Playing-Cards/card-spades-2.png", 2],
    "3♠": ["Playing-Cards/card-spades-3.png", 3], "4♠": ["Playing-Cards/card-spades-4.png", 4],
    "5♠": ["Playing-Cards/card-spades-5.png", 5], "6♠": ["Playing-Cards/card-spades-6.png", 6],
    "7♠": ["Playing-Cards/card-spades-7.png", 7], "8♠": ["Playing-Cards/card-spades-8.png", 8],
    "9♠": ["Playing-Cards/card-spades-9.png", 9], "10♠": ["Playing-Cards/card-spades-10.png", 10],
    "J♠": ["Playing-Cards/card-spades-11.png", 10], "Q♠": ["Playing-Cards/card-spades-12.png", 10],
    "K♠": ["Playing-Cards/card-spades-13.png", 10], "1♥": ["Playing-Cards/card-hearts-1.png", 11],
    "2♥": ["Playing-Cards/card-hearts-2.png", 2], "3♥": ["Playing-Cards/card-hearts-3.png", 3],
    "4♥": ["Playing-Cards/card-hearts-4.png", 4], "5♥": ["Playing-Cards/card-hearts-5.png", 5],
    "6♥": ["Playing-Cards/card-hearts-6.png", 6], "7♥": ["Playing-Cards/card-hearts-7.png", 7],
    "8♥": ["Playing-Cards/card-hearts-8.png", 8], "9♥": ["Playing-Cards/card-hearts-9.png", 9],
    "10♥": ["Playing-Cards/card-hearts-10.png", 10], "J♥": ["Playing-Cards/card-hearts-11.png", 10],
    "Q♥": ["Playing-Cards/card-hearts-12.png", 10], "K♥": ["Playing-Cards/card-hearts-13.png", 10],
    "1♣": ["Playing-Cards/card-clubs-1.png", 11], "2♣": ["Playing-Cards/card-clubs-2.png", 2],
    "3♣": ["Playing-Cards/card-clubs-3.png", 3], "4♣": ["Playing-Cards/card-clubs-4.png", 4],
    "5♣": ["Playing-Cards/card-clubs-5.png", 5], "6♣": ["Playing-Cards/card-clubs-6.png", 6],
    "7♣": ["Playing-Cards/card-clubs-7.png", 7], "8♣": ["Playing-Cards/card-clubs-8.png", 8],
    "9♣": ["Playing-Cards/card-clubs-9.png", 9], "10♣": ["Playing-Cards/card-clubs-10.png", 10],
    "J♣": ["Playing-Cards/card-clubs-11.png", 10], "Q♣": ["Playing-Cards/card-clubs-12.png", 10],
    "K♣": ["Playing-Cards/card-clubs-13.png", 10], "1♦": ["Playing-Cards/card-diamonds-1.png", 11],
    "2♦": ["Playing-Cards/card-diamonds-2.png", 2], "3♦": ["Playing-Cards/card-diamonds-3.png", 3],
    "4♦": ["Playing-Cards/card-diamonds-4.png", 4], "5♦": ["Playing-Cards/card-diamonds-5.png", 5],
    "6♦": ["Playing-Cards/card-diamonds-6.png", 6], "7♦": ["Playing-Cards/card-diamonds-7.png", 7],
    "8♦": ["Playing-Cards/card-diamonds-8.png", 8], "9♦": ["Playing-Cards/card-diamonds-9.png", 9],
    "10♦": ["Playing-Cards/card-diamonds-10.png", 10], "J♦": ["Playing-Cards/card-diamonds-11.png", 10],
    "Q♦": ["Playing-Cards/card-diamonds-12.png", 10], "K♦": ["Playing-Cards/card-diamonds-13.png", 10]
}

keys = list(deck.keys())
player = []
dealer = []
stay_counter = []

def update_display():
    player_area = document.querySelector("#player-cards")
    dealer_area = document.querySelector("#dealer-cards")
    player_area.innerHTML = ""
    dealer_area.innerHTML = ""

    for card in player:
        img = document.createElement("img")
        img.src = deck[card][0]
        img.className = "card"
        player_area.appendChild(img)

    for i, card in enumerate(dealer):
        img = document.createElement("img")
        if i == 0 and len(stay_counter) == 0:
            img.src = "Playing-Cards/card-back2.png"
        else:
            img.src = deck[card][0]
        img.className = "card"
        dealer_area.appendChild(img)

    document.querySelector("#score").textContent = f"Player: {sum([deck[c][1] for c in player])} | Dealer: {sum([deck[c][1] for c in dealer]) if len(stay_counter) > 0 else '?'}"

def deal_cards():
    global player, dealer, keys, stay_counter
    player = []
    dealer = []
    stay_counter = []
    random.shuffle(keys)
    
    player.append(keys.pop())
    dealer.append(keys.pop())
    player.append(keys.pop())
    dealer.append(keys.pop())

    update_display()
    document.querySelector("#deal-button").disabled = True
    document.querySelector("#hit-button").disabled = False
    document.querySelector("#stay-button").disabled = False

def hit():
    player.append(keys.pop())
    update_display()
    check_score()

def stay():
    stay_counter.append(1)
    npc()
    check_score()

def npc():
    while sum([deck[c][1] for c in dealer]) < 17:
        dealer.append(keys.pop())
    update_display()

def check_score():
    player_score = sum([deck[c][1] for c in player])
    dealer_score = sum([deck[c][1] for c in dealer])

    if player_score > 21:
        end_game("Player busts! Dealer wins!")
    elif len(stay_counter) > 0:
        if dealer_score > 21:
            end_game("Dealer busts! Player wins!")
        elif player_score > dealer_score:
            end_game("Player wins!")
        elif dealer_score > player_score:
            end_game("Dealer wins!")
        else:
            end_game("It's a tie!")

def end_game(message):
    document.querySelector("#score").textContent += f" | {message}"
    document.querySelector("#deal-button").disabled = False
    document.querySelector("#hit-button").disabled = True
    document.querySelector("#stay-button").disabled = True

# Initialize the game
deal_cards()

    </py-script>
</body>
</html>